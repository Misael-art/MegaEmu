#include "modern_effects.h"#include <stdlib.h>#include <string.h>#include <math.h>// Inicialização do sistemagui_result_t modern_effects_init(modern_effect_system_t *system,                                 gui_shader_system_t *shaders,                                 int source_width,                                 int source_height){    if (!system || !shaders || source_width <= 0 || source_height <= 0)        return GUI_ERROR_INVALID_PARAM;    system->shader_system = shaders;    system->source_width = source_width;    system->source_height = source_height;    system->scene_buffer = NULL;    system->light_buffer = NULL;    system->mask_buffer = NULL;    system->depth_buffer = NULL;    system->particle_buffer = NULL;    system->initialized = GUI_TRUE;    system->time = 0.0f;    // Criar buffers    SDL_Renderer *renderer = system->shader_system->renderer;    // Buffer de cena    system->scene_buffer = SDL_CreateTexture(renderer,                                             SDL_PIXELFORMAT_RGBA8888,                                             SDL_TEXTUREACCESS_TARGET,                                             source_width, source_height);    // Buffer de luz    system->light_buffer = SDL_CreateTexture(renderer,                                             SDL_PIXELFORMAT_RGBA8888,                                             SDL_TEXTUREACCESS_TARGET,                                             source_width, source_height);    // Buffer de máscara    system->mask_buffer = SDL_CreateTexture(renderer,                                            SDL_PIXELFORMAT_RGBA8888,                                            SDL_TEXTUREACCESS_TARGET,                                            source_width, source_height);    // Buffer de profundidade    system->depth_buffer = SDL_CreateTexture(renderer,                                             SDL_PIXELFORMAT_RGBA8888,                                             SDL_TEXTUREACCESS_TARGET,                                             source_width, source_height);    // Buffer de partículas    system->particle_buffer = SDL_CreateTexture(renderer,                                                SDL_PIXELFORMAT_RGBA8888,                                                SDL_TEXTUREACCESS_TARGET,                                                source_width, source_height);    if (!system->scene_buffer || !system->light_buffer || !system->mask_buffer ||        !system->depth_buffer || !system->particle_buffer)    {        modern_effects_shutdown(system);        return GUI_ERROR_INIT_FAILED;    }    // Configurar parâmetros padrão    memset(&system->params, 0, sizeof(modern_effect_params_t));    // Luz volumétrica    system->params.volumetric.density = 0.3f;    system->params.volumetric.scatter = 0.5f;    system->params.volumetric.num_samples = 20;    system->params.volumetric.falloff = 1.0f;    system->params.volumetric.light_color = (gui_color_t){255, 230, 180, 255};    system->params.volumetric.use_noise = GUI_TRUE;    system->params.volumetric.noise_scale = 1.0f;    // Clima    system->params.weather.type = WEATHER_NONE;    system->params.weather.intensity = 0.5f;    system->params.weather.wind_speed = 1.0f;    system->params.weather.wind_direction = 0.0f;    system->params.weather.accumulation = 0.0f;    system->params.weather.splash_size = 1.0f;    system->params.weather.weather_color = (gui_color_t){255, 255, 255, 255};    system->params.weather.use_lighting = GUI_TRUE;    // Reflexão    system->params.reflection.reflection_strength = 0.5f;    system->params.reflection.roughness = 0.1f;    system->params.reflection.fresnel = 1.0f;    system->params.reflection.max_steps = 16;    system->params.reflection.thickness = 0.1f;    system->params.reflection.use_blur = GUI_TRUE;    system->params.reflection.blur_radius = 2.0f;    // Partículas    system->params.particles.max_particles = 1000;    system->params.particles.spawn_rate = 10.0f;    system->params.particles.lifetime = 2.0f;    system->params.particles.size_start = 1.0f;    system->params.particles.size_end = 0.1f;    system->params.particles.color_start = (gui_color_t){255, 255, 255, 255};    system->params.particles.color_end = (gui_color_t){255, 255, 255, 0};    system->params.particles.velocity = 1.0f;    system->params.particles.gravity = 0.0f;    system->params.particles.collide = GUI_FALSE;    system->params.particles.emit_light = GUI_FALSE;    // Profundidade    system->params.depth.focal_distance = 0.5f;    system->params.depth.focal_range = 0.2f;    system->params.depth.blur_strength = 1.0f;    system->params.depth.blur_samples = 16;    system->params.depth.use_bokeh = GUI_FALSE;    system->params.depth.bokeh_threshold = 0.5f;    // Global    system->params.global_intensity = 1.0f;    system->params.enable_hdr = GUI_TRUE;    system->params.exposure = 1.0f;    return GUI_SUCCESS;}// Finalização do sistemavoid modern_effects_shutdown(modern_effect_system_t *system){    if (!system)        return;    if (system->scene_buffer)        SDL_DestroyTexture(system->scene_buffer);    if (system->light_buffer)        SDL_DestroyTexture(system->light_buffer);    if (system->mask_buffer)        SDL_DestroyTexture(system->mask_buffer);    if (system->depth_buffer)        SDL_DestroyTexture(system->depth_buffer);    if (system->particle_buffer)        SDL_DestroyTexture(system->particle_buffer);    system->initialized = GUI_FALSE;}// Configurar parâmetrosgui_result_t modern_effects_set_params(modern_effect_system_t *system,                                       const modern_effect_params_t *params){    if (!system || !params)        return GUI_ERROR_INVALID_PARAM;    system->params = *params;    return GUI_SUCCESS;}// Início de framegui_result_t modern_effects_begin_frame(modern_effect_system_t *system,                                        SDL_Texture *target){    if (!system || !system->initialized || !target)        return GUI_ERROR_INVALID_PARAM;    // Atualizar tempo    system->time += 1.0f / 60.0f; // Assumindo 60 FPS    // Iniciar sistema de shaders    return gui_shaders_begin(system->shader_system, target);}// Aplicar efeitosgui_result_t modern_effects_apply(modern_effect_system_t *system,                                  SDL_Texture *source,                                  SDL_Texture *target){    if (!system || !system->initialized || !source || !target)        return GUI_ERROR_INVALID_PARAM;    // Copiar cena original para buffer    SDL_SetRenderTarget(system->shader_system->renderer, system->scene_buffer);    SDL_RenderCopy(system->shader_system->renderer, source, NULL, NULL);    // Aplicar efeitos na ordem correta    SDL_Texture *current = system->scene_buffer;    // 1. Luz volumétrica    modern_effect_apply_volumetric(system, current, system->light_buffer,                                   &system->params.volumetric);    current = system->light_buffer;    // 2. Reflexões    modern_effect_apply_reflection(system, current, system->scene_buffer,                                   &system->params.reflection);    current = system->scene_buffer;    // 3. Partículas    modern_effect_apply_particles(system, current, system->particle_buffer,                                  &system->params.particles);    current = system->particle_buffer;    // 4. Clima    modern_effect_apply_weather(system, current, system->scene_buffer,                                &system->params.weather);    current = system->scene_buffer;    // 5. Profundidade    modern_effect_apply_depth(system, current, system->light_buffer,                              &system->params.depth);    current = system->light_buffer;    // Renderizar resultado final    SDL_SetRenderTarget(system->shader_system->renderer, target);    SDL_RenderCopy(system->shader_system->renderer, current, NULL, NULL);    return GUI_SUCCESS;}// Fim de framegui_result_t modern_effects_end_frame(modern_effect_system_t *system){    if (!system || !system->initialized)        return GUI_ERROR_INVALID_PARAM;    return gui_shaders_end(system->shader_system);}// As implementações dos efeitos específicos (modern_effect_apply_*) serão feitas// nos respectivos arquivos de shader GLSL