/** * @file frontend_config.c * @brief Implementação das funções de configuração do frontend */#include "frontend_config.h"#include "utils/log_utils.h"#include "utils/enhanced_log.h"#include "utils/log_categories.h"#include <stdio.h>#include <string.h>#include <ctype.h>#define CONFIG_LINE_MAX 256#define CONFIG_FILE_HEADER "# Configuração do emulador\n# Gerado automaticamente\n\n"// Configuração padrão do frontendconst emu_frontend_config_t EMU_DEFAULT_FRONTEND_CONFIG = {    // Vídeo    .window_width = 800,    .window_height = 600,    .game_width = 256,    .game_height = 240,    .scale_factor = 2.0f,    .vsync_enabled = true,    .fullscreen = false,    .smooth_scaling = false,    .integer_scaling = true,    // Áudio    .audio_sample_rate = 44100,    .audio_buffer_size = 2048,    .audio_enabled = true,    // Entrada    .keyboard_enabled = true,    .gamepad_enabled = true,    // Interface    .show_fps = true,    .debug_overlay = false};void emu_frontend_config_init(void){    EMU_LOG_INFO(EMU_LOG_CAT_FRONTEND, "Inicializando configuração do frontend");}static void trim(char *str){    char *start = str;    char *end = str + strlen(str) - 1;    // Remover espaços do início    while (isspace((unsigned char)*start))        start++;    // Se a string é só espaços    if (*start == 0)    {        *str = 0;        return;    }    // Remover espaços do fim    while (end > start && isspace((unsigned char)*end))        end--;    *(end + 1) = 0;    // Mover a string se necessário    if (start > str)    {        while (*start)            *str++ = *start++;        *str = 0;    }}int frontend_config_load(const char *filename, emu_frontend_config_t *config){    if (!filename || !config)    {        EMU_LOG_ERROR(EMU_LOG_CAT_FRONTEND, "Parâmetros inválidos para carregamento de configuração");        return -1;    }    FILE *file = fopen(filename, "r");    if (!file)    {        EMU_LOG_ERROR(EMU_LOG_CAT_FRONTEND, "Não foi possível abrir o arquivo de configuração: %s", filename);        return -1;    }    char line[CONFIG_LINE_MAX];    char key[CONFIG_LINE_MAX];    char value[CONFIG_LINE_MAX];    while (fgets(line, sizeof(line), file))    {        // Ignorar comentários e linhas vazias        if (line[0] == '#' || line[0] == '\n' || line[0] == '\r')        {            continue;        }        // Remover espaços e quebras de linha        trim(line);        if (strlen(line) == 0)        {            continue;        }        // Separar chave e valor        if (sscanf(line, "%[^=]=%s", key, value) != 2)        {            EMU_LOG_WARN(EMU_LOG_CAT_FRONTEND, "Linha de configuração inválida: %s", line);            continue;        }        trim(key);        trim(value);        // Processar configurações        if (strcmp(key, "window_width") == 0)        {            config->window_width = atoi(value);        }        else if (strcmp(key, "window_height") == 0)        {            config->window_height = atoi(value);        }        else if (strcmp(key, "fullscreen") == 0)        {            config->fullscreen = (strcmp(value, "true") == 0);        }        else if (strcmp(key, "vsync") == 0)        {            config->vsync_enabled = (strcmp(value, "true") == 0);        }        else if (strcmp(key, "scale_mode") == 0)        {            config->scale_factor = atof(value);        }        else if (strcmp(key, "audio_enabled") == 0)        {            config->audio_enabled = (strcmp(value, "true") == 0);        }        else if (strcmp(key, "audio_volume") == 0)        {            config->audio_volume = atof(value);        }        else if (strcmp(key, "input_device") == 0)        {            strncpy(config->input_device, value, sizeof(config->input_device) - 1);        }        else        {            EMU_LOG_WARN(EMU_LOG_CAT_FRONTEND, "Configuração desconhecida: %s", key);        }    }    fclose(file);    return 0;}int frontend_config_save(const char *filename, const emu_frontend_config_t *config){    if (!filename || !config)    {        EMU_LOG_ERROR(EMU_LOG_CAT_FRONTEND, "Parâmetros inválidos para salvamento de configuração");        return -1;    }    FILE *file = fopen(filename, "w");    if (!file)    {        EMU_LOG_ERROR(EMU_LOG_CAT_FRONTEND, "Não foi possível criar o arquivo de configuração: %s", filename);        return -1;    }    // Escrever cabeçalho    fprintf(file, CONFIG_FILE_HEADER);    // Escrever configurações    fprintf(file, "window_width=%d\n", config->window_width);    fprintf(file, "window_height=%d\n", config->window_height);    fprintf(file, "fullscreen=%s\n", config->fullscreen ? "true" : "false");    fprintf(file, "vsync=%s\n", config->vsync_enabled ? "true" : "false");    fprintf(file, "scale_mode=%.2f\n", config->scale_factor);    fprintf(file, "audio_enabled=%s\n", config->audio_enabled ? "true" : "false");    fprintf(file, "audio_volume=%.2f\n", config->audio_volume);    fprintf(file, "input_device=%s\n", config->input_device);    fclose(file);    return 0;}void emu_frontend_config_set_defaults(emu_frontend_config_t *config){    if (!config)        return;    memcpy(config, &EMU_DEFAULT_FRONTEND_CONFIG, sizeof(emu_frontend_config_t));}