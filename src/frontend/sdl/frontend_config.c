#include "frontend_config.h"#include "utils/log_utils.h"#include "utils/log_categories.h"#include "utils/enhanced_log.h"#include <stdio.h>#include <string.h>#include <ctype.h>// Configuração padrão do frontendconst frontend_config_t DEFAULT_FRONTEND_CONFIG = {    // Vídeo    .window_width = 800,    .window_height = 600,    .game_width = 256,    .game_height = 240,    .scale_factor = 2.0f,    .vsync_enabled = true,    .fullscreen = false,    .smooth_scaling = false,    .integer_scaling = true,    // Áudio    .audio_sample_rate = 44100,    .audio_buffer_size = 2048,    .audio_enabled = true,    // Entrada    .keyboard_enabled = true,    .gamepad_enabled = true,    // Interface    .show_fps = true,    .debug_overlay = false};void frontend_config_init(void){    EMU_LOG_INFO(EMU_LOG_CAT_FRONTEND, "Inicializando configuração do frontend");}int frontend_config_load(const char *filename){    if (!filename)    {        LOG_ERROR("Nome do arquivo de configuração inválido");        return FRONTEND_ERROR_INVALID_PARAM;    }    FILE *file = fopen(filename, "r");    if (!file)    {        LOG_ERROR("Falha ao abrir arquivo de configuração: %s", filename);        return FRONTEND_ERROR_FILE_NOT_FOUND;    }    char line[256];    char key[128];    char value[128];    while (fgets(line, sizeof(line), file))    {        // Ignorar comentários e linhas vazias        if (line[0] == '#' || line[0] == '\n')        {            continue;        }        // Extrair chave e valor        if (sscanf(line, "%127[^=]=%127s", key, value) == 2)        {            // Remover espaços em branco            char *k = key;            char *v = value;            while (*k && isspace(*k))                k++;            while (*v && isspace(*v))                v++;            char *end = k + strlen(k) - 1;            while (end > k && isspace(*end))                *end-- = '\0';            end = v + strlen(v) - 1;            while (end > v && isspace(*end))                *end-- = '\0';            // Processar configurações            if (strcmp(k, "window_width") == 0)            {                g_config.window_width = atoi(v);            }            else if (strcmp(k, "window_height") == 0)            {                g_config.window_height = atoi(v);            }            else if (strcmp(k, "fullscreen") == 0)            {                g_config.fullscreen = (strcmp(v, "true") == 0);            }            else if (strcmp(k, "vsync") == 0)            {                g_config.vsync_enabled = (strcmp(v, "true") == 0);            }            else if (strcmp(k, "scale_mode") == 0)            {                g_config.scale_factor = atof(v);            }            else if (strcmp(k, "audio_enabled") == 0)            {                g_config.audio_enabled = (strcmp(v, "true") == 0);            }            else if (strcmp(k, "audio_volume") == 0)            {                g_config.audio_volume = atoi(v);            }            else if (strcmp(k, "input_device") == 0)            {                strncpy(g_config.input_device, v, sizeof(g_config.input_device) - 1);            }            else            {                LOG_WARN("Configuração desconhecida: %s", k);            }        }    }    fclose(file);    return FRONTEND_ERROR_NONE;}int frontend_config_save(const char *filename){    if (!filename)    {        LOG_ERROR("Nome do arquivo de configuração inválido");        return FRONTEND_ERROR_INVALID_PARAM;    }    FILE *file = fopen(filename, "w");    if (!file)    {        LOG_ERROR("Falha ao criar arquivo de configuração: %s", filename);        return FRONTEND_ERROR_FILE_NOT_FOUND;    }    // Escrever cabeçalho    fprintf(file, "# Configuração do Frontend\n");    fprintf(file, "# Gerado automaticamente\n\n");    // Escrever configurações    fprintf(file, "window_width=%d\n", g_config.window_width);    fprintf(file, "window_height=%d\n", g_config.window_height);    fprintf(file, "fullscreen=%s\n", g_config.fullscreen ? "true" : "false");    fprintf(file, "vsync=%s\n", g_config.vsync_enabled ? "true" : "false");    fprintf(file, "scale_mode=%f\n", g_config.scale_factor);    fprintf(file, "audio_enabled=%s\n", g_config.audio_enabled ? "true" : "false");    fprintf(file, "audio_volume=%d\n", g_config.audio_volume);    fprintf(file, "input_device=%s\n", g_config.input_device);    fclose(file);    return FRONTEND_ERROR_NONE;}void frontend_config_set_defaults(frontend_config_t *config){    if (!config)        return;    memcpy(config, &DEFAULT_FRONTEND_CONFIG, sizeof(frontend_config_t));}