#include "menu_sounds.h"#include <math.h>#include <stdlib.h>#include <string.h>#define SAMPLE_RATE 44100#define AMPLITUDE 28000#define PI 3.14159265358979323846static menu_sounds_t g_menu_sounds = {0};// Função auxiliar para gerar um tomstatic void generate_tone(uint8_t *buffer, int length, float frequency, float duration){    int16_t *samples = (int16_t *)buffer;    int num_samples = (int)(SAMPLE_RATE * duration);    float angular_frequency = 2.0f * PI * frequency;    for (int i = 0; i < num_samples && i < length / 2; i++)    {        float time = (float)i / SAMPLE_RATE;        float envelope = 1.0f;        // Aplicar envelope ADSR simples        float attack = 0.02f;        float decay = 0.05f;        float sustain = 0.7f;        float release = 0.1f;        if (time < attack)        {            envelope = time / attack;        }        else if (time < attack + decay)        {            envelope = 1.0f - (1.0f - sustain) * ((time - attack) / decay);        }        else if (time < duration - release)        {            envelope = sustain;        }        else        {            envelope = sustain * (1.0f - (time - (duration - release)) / release);        }        samples[i] = (int16_t)(AMPLITUDE * envelope * sin(angular_frequency * time));    }}bool menu_sounds_init(void){    SDL_AudioSpec want, have;    SDL_memset(&want, 0, sizeof(want));    want.freq = SAMPLE_RATE;    want.format = AUDIO_S16;    want.channels = 1;    want.samples = 4096;    want.callback = NULL;    g_menu_sounds.device = SDL_OpenAudioDevice(NULL, 0, &want, &have, 0);    if (g_menu_sounds.device == 0)    {        return false;    }    // Gerar sons    // Som de hover: tom agudo curto    g_menu_sounds.hover_length = (int)(SAMPLE_RATE * 0.05); // 50ms    g_menu_sounds.hover_sound = (uint8_t *)malloc(g_menu_sounds.hover_length * sizeof(int16_t));    if (!g_menu_sounds.hover_sound)        return false;    generate_tone(g_menu_sounds.hover_sound, g_menu_sounds.hover_length * sizeof(int16_t), 2000.0f, 0.05f);    // Som de seleção: dois tons ascendentes    g_menu_sounds.select_length = (int)(SAMPLE_RATE * 0.15); // 150ms    g_menu_sounds.select_sound = (uint8_t *)malloc(g_menu_sounds.select_length * sizeof(int16_t));    if (!g_menu_sounds.select_sound)    {        free(g_menu_sounds.hover_sound);        return false;    }    int first_tone_samples = (int)(SAMPLE_RATE * 0.07);    generate_tone(g_menu_sounds.select_sound, first_tone_samples * sizeof(int16_t), 1500.0f, 0.07f);    generate_tone(g_menu_sounds.select_sound + first_tone_samples * sizeof(int16_t),                  (g_menu_sounds.select_length - first_tone_samples) * sizeof(int16_t),                  2000.0f, 0.08f);    // Som de voltar: tom descendente    g_menu_sounds.back_length = (int)(SAMPLE_RATE * 0.1); // 100ms    g_menu_sounds.back_sound = (uint8_t *)malloc(g_menu_sounds.back_length * sizeof(int16_t));    if (!g_menu_sounds.back_sound)    {        free(g_menu_sounds.hover_sound);        free(g_menu_sounds.select_sound);        return false;    }    generate_tone(g_menu_sounds.back_sound, g_menu_sounds.back_length * sizeof(int16_t), 1000.0f, 0.1f);    SDL_PauseAudioDevice(g_menu_sounds.device, 0);    return true;}void menu_sounds_play_hover(void){    if (g_menu_sounds.device != 0 && g_menu_sounds.hover_sound != NULL)    {        SDL_QueueAudio(g_menu_sounds.device, g_menu_sounds.hover_sound, g_menu_sounds.hover_length * sizeof(int16_t));    }}void menu_sounds_play_select(void){    if (g_menu_sounds.device != 0 && g_menu_sounds.select_sound != NULL)    {        SDL_QueueAudio(g_menu_sounds.device, g_menu_sounds.select_sound, g_menu_sounds.select_length * sizeof(int16_t));    }}void menu_sounds_play_back(void){    if (g_menu_sounds.device != 0 && g_menu_sounds.back_sound != NULL)    {        SDL_QueueAudio(g_menu_sounds.device, g_menu_sounds.back_sound, g_menu_sounds.back_length * sizeof(int16_t));    }}void menu_sounds_shutdown(void){    if (g_menu_sounds.device != 0)    {        SDL_CloseAudioDevice(g_menu_sounds.device);        g_menu_sounds.device = 0;    }    free(g_menu_sounds.hover_sound);    free(g_menu_sounds.select_sound);    free(g_menu_sounds.back_sound);    g_menu_sounds.hover_sound = NULL;    g_menu_sounds.select_sound = NULL;    g_menu_sounds.back_sound = NULL;}