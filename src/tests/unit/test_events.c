/** * @file test_events.c * @brief Testes unitários para o sistema de eventos */#include <stdio.h>#include <stdlib.h>#include <string.h>#include <assert.h>#include "core/events/events_interface.h"#include "test_common.h"// Variáveis para testesstatic int g_test_callback_called = 0;static emu_event_t g_last_event = {0};// Callback de testestatic void test_callback(emu_event_t *event, void *userdata){    g_test_callback_called = 1;    memcpy(&g_last_event, event, sizeof(emu_event_t));}// Teste de inicializaçãostatic void test_init(void){    const emu_events_interface_t *events = emu_events_get_interface();    assert(events != NULL);    int result = events->init();    assert(result == 0);    // Tentar inicializar novamente    result = events->init();    assert(result == 0); // Deve retornar sucesso mesmo já inicializado    events->shutdown();}// Teste de registro de callbacksstatic void test_register_callback(void){    const emu_events_interface_t *events = emu_events_get_interface();    assert(events != NULL);    events->init();    // Registrar callback    int result = events->register_callback(EMU_EVENT_FRAME_START, test_callback, NULL);    assert(result == 0);    // Tentar registrar callback inválido    result = events->register_callback(EMU_EVENT_MAX, test_callback, NULL);    assert(result == -1);    // Tentar registrar callback nulo    result = events->register_callback(EMU_EVENT_FRAME_START, NULL, NULL);    assert(result == -1);    events->shutdown();}// Teste de disparo de eventosstatic void test_trigger_event(void){    const emu_events_interface_t *events = emu_events_get_interface();    assert(events != NULL);    events->init();    // Registrar callback    events->register_callback(EMU_EVENT_FRAME_START, test_callback, NULL);    // Disparar evento    g_test_callback_called = 0;    int result = events->trigger_event(EMU_EVENT_FRAME_START, NULL, 0);    assert(result == 0);    assert(g_test_callback_called == 1);    // Disparar evento inválido    result = events->trigger_event(EMU_EVENT_MAX, NULL, 0);    assert(result == -1);    events->shutdown();}// Teste de pausa/resumestatic void test_pause_resume(void){    const emu_events_interface_t *events = emu_events_get_interface();    assert(events != NULL);    events->init();    // Registrar callback    events->register_callback(EMU_EVENT_FRAME_START, test_callback, NULL);    // Pausar eventos    events->pause();    g_test_callback_called = 0;    events->trigger_event(EMU_EVENT_FRAME_START, NULL, 0);    assert(g_test_callback_called == 0);    // Retomar eventos    events->resume();    g_test_callback_called = 0;    events->trigger_event(EMU_EVENT_FRAME_START, NULL, 0);    assert(g_test_callback_called == 1);    events->shutdown();}// Teste de resetstatic void test_reset(void){    const emu_events_interface_t *events = emu_events_get_interface();    assert(events != NULL);    events->init();    // Registrar callback    events->register_callback(EMU_EVENT_FRAME_START, test_callback, NULL);    // Resetar sistema    events->reset();    g_test_callback_called = 0;    events->trigger_event(EMU_EVENT_FRAME_START, NULL, 0);    assert(g_test_callback_called == 0);    events->shutdown();}// Teste de dados de eventostatic void test_event_data(void){    const emu_events_interface_t *events = emu_events_get_interface();    assert(events != NULL);    events->init();    // Registrar callback    events->register_callback(EMU_EVENT_MEMORY_WRITE, test_callback, NULL);    // Criar dados de teste    struct    {        uint32_t address;        uint8_t value;    } test_data = {        .address = 0x12345678,        .value = 0x42};    // Disparar evento com dados    events->trigger_event(EMU_EVENT_MEMORY_WRITE, &test_data, sizeof(test_data));    assert(g_last_event.type == EMU_EVENT_MEMORY_WRITE);    assert(g_last_event.data_size == sizeof(test_data));    // Verificar dados    const struct    {        uint32_t address;        uint8_t value;    } *received_data = (const struct {                           uint32_t address;                           uint8_t value;                       } *)g_last_event.data;    assert(received_data->address == test_data.address);    assert(received_data->value == test_data.value);    events->shutdown();}// Executar todos os testesvoid test_events_run_all(void){    printf("Executando testes do sistema de eventos...\n");    test_init();    printf("✓ Teste de inicialização passou\n");    test_register_callback();    printf("✓ Teste de registro de callbacks passou\n");    test_trigger_event();    printf("✓ Teste de disparo de eventos passou\n");    test_pause_resume();    printf("✓ Teste de pausa/resume passou\n");    test_reset();    printf("✓ Teste de reset passou\n");    test_event_data();    printf("✓ Teste de dados de evento passou\n");    printf("✓ Todos os testes do sistema de eventos passaram!\n\n");}