#include "test_framework.h"#include <stdio.h>#include <stdlib.h>#include <string.h>// Estado global do frameworkstatic struct{    nes_test_suite_t **suites;    int num_suites;    int max_suites;} g_test_framework = {0};void nes_test_init(void){    g_test_framework.max_suites = 10;    g_test_framework.suites = malloc(sizeof(nes_test_suite_t *) * g_test_framework.max_suites);    g_test_framework.num_suites = 0;    if (!g_test_framework.suites)    {        printf("❌ Falha ao inicializar framework de testes\n");        exit(1);    }}void nes_test_shutdown(void){    if (g_test_framework.suites)    {        free(g_test_framework.suites);        g_test_framework.suites = NULL;    }    g_test_framework.num_suites = 0;    g_test_framework.max_suites = 0;}void nes_test_register_suite(nes_test_suite_t *suite){    if (!suite)    {        printf("❌ Tentativa de registrar suite NULL\n");        return;    }    // Verifica se precisa expandir o array    if (g_test_framework.num_suites >= g_test_framework.max_suites)    {        g_test_framework.max_suites *= 2;        nes_test_suite_t **new_suites = realloc(g_test_framework.suites,                                                sizeof(nes_test_suite_t *) * g_test_framework.max_suites);        if (!new_suites)        {            printf("❌ Falha ao expandir array de suites\n");            return;        }        g_test_framework.suites = new_suites;    }    g_test_framework.suites[g_test_framework.num_suites++] = suite;}nes_test_results_t nes_test_run_all(void){    nes_test_results_t results = {0};    results.failed_tests = malloc(sizeof(char *) * 100); // Assume max 100 falhas    printf("\n=== Iniciando execução de testes ===\n\n");    for (int i = 0; i < g_test_framework.num_suites; i++)    {        nes_test_suite_t *suite = g_test_framework.suites[i];        printf("Suíte: %s\n", suite->name);        if (suite->suite_setup)        {            suite->suite_setup();        }        for (int j = 0; j < suite->num_tests; j++)        {            nes_test_case_t *test = &suite->tests[j];            printf("  Teste: %s\n", test->name);            if (test->description)            {                printf("  Descrição: %s\n", test->description);            }            results.tests_run++;            if (test->setup)            {                test->setup();            }            bool passed = test->run();            if (test->teardown)            {                test->teardown();            }            if (passed)            {                results.tests_passed++;                printf("  ✅ PASSOU\n");            }            else            {                results.tests_failed++;                results.failed_tests[results.tests_failed - 1] = strdup(test->name);                printf("  ❌ FALHOU\n");            }            printf("\n");        }        if (suite->suite_teardown)        {            suite->suite_teardown();        }    }    return results;}void nes_test_print_results(const nes_test_results_t *results){    printf("\n=== Resumo dos Testes ===\n");    printf("Total de testes: %d\n", results->tests_run);    printf("Testes passados: %d\n", results->tests_passed);    printf("Testes falhos: %d\n", results->tests_failed);    if (results->tests_failed > 0)    {        printf("\nTestes que falharam:\n");        for (int i = 0; i < results->tests_failed; i++)        {            printf("- %s\n", results->failed_tests[i]);            free(results->failed_tests[i]);        }    }    free(results->failed_tests);    printf("\n%s\n",           results->tests_failed == 0 ? "✅ Todos os testes passaram!" : "❌ Alguns testes falharam.");}