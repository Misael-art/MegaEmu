#include <stdio.h>#include <stdlib.h>#include <string.h>#include <assert.h>#include "../frontend/common/frontend.h"#include "../frontend/common/frontend_internal.h"// Implementação mock do frontend para testesemu_frontend_t emu_frontend_init(void){    struct emu_frontend *frontend = calloc(1, sizeof(struct emu_frontend));    if (!frontend)        return NULL;    frontend->width = 320;    frontend->height = 240;    frontend->framebuffer = calloc(frontend->width * frontend->height, sizeof(uint32_t));    if (!frontend->framebuffer)    {        free(frontend);        return NULL;    }    frontend->initialized = true;    frontend->window_handle = NULL;    return frontend;}void emu_frontend_shutdown(emu_frontend_t frontend){    struct emu_frontend *impl = frontend;    if (!impl)        return;    if (impl->framebuffer)        free(impl->framebuffer);    impl->initialized = false;    free(impl);}bool emu_frontend_process_events(emu_frontend_t frontend){    struct emu_frontend *impl = frontend;    if (!impl)        return false;    return impl->initialized;}int emu_frontend_render_frame(emu_frontend_t frontend, const uint32_t *framebuffer, int width, int height){    struct emu_frontend *impl = frontend;    if (!impl)        return -1;    if (!impl->initialized)        return -1;    if (!framebuffer)        return -1;    if (width <= 0 || height <= 0)        return -1;    if (width != impl->width || height != impl->height)    {        uint32_t *new_buffer = realloc(impl->framebuffer, width * height * sizeof(uint32_t));        if (!new_buffer)            return -1;        impl->framebuffer = new_buffer;        impl->width = width;        impl->height = height;    }    memcpy(impl->framebuffer, framebuffer, width * height * sizeof(uint32_t));    return 0;}int emu_frontend_update_window(emu_frontend_t frontend){    struct emu_frontend *impl = frontend;    if (!impl)        return -1;    if (!impl->initialized)        return -1;    return 0;}static void test_frontend_init(void){    printf("Testando inicialização do frontend...\n");    // Teste 1: Inicialização básica    emu_frontend_t frontend = emu_frontend_init();    assert(frontend != NULL);    struct emu_frontend *impl = frontend;    assert(impl->initialized == true);    assert(impl->width == 320);    assert(impl->height == 240);    assert(impl->framebuffer != NULL);    assert(impl->window_handle == NULL);    // Teste 2: Inicialização dupla    emu_frontend_t frontend2 = emu_frontend_init();    assert(frontend2 != NULL);    struct emu_frontend *impl2 = frontend2;    assert(impl2->initialized == true);    // Teste 3: Shutdown    emu_frontend_shutdown(frontend);    emu_frontend_shutdown(frontend2);    emu_frontend_shutdown(NULL); // Não deve causar crash    printf("Testes de inicialização concluídos com sucesso!\n");}static void test_frontend_framebuffer(void){    printf("Testando manipulação do framebuffer...\n");    // Teste 1: Criar frontend    emu_frontend_t frontend = emu_frontend_init();    assert(frontend != NULL);    // Teste 2: Renderizar frame com parâmetros válidos    uint32_t *test_buffer = calloc(320 * 240, sizeof(uint32_t));    assert(test_buffer != NULL);    int result = emu_frontend_render_frame(frontend, test_buffer, 320, 240);    assert(result == 0);    // Teste 3: Renderizar frame com parâmetros inválidos    result = emu_frontend_render_frame(NULL, test_buffer, 320, 240);    assert(result == -1);    result = emu_frontend_render_frame(frontend, NULL, 320, 240);    assert(result == -1);    result = emu_frontend_render_frame(frontend, test_buffer, 0, 240);    assert(result == -1);    result = emu_frontend_render_frame(frontend, test_buffer, 320, 0);    assert(result == -1);    // Teste 4: Redimensionar framebuffer    uint32_t *larger_buffer = calloc(640 * 480, sizeof(uint32_t));    assert(larger_buffer != NULL);    result = emu_frontend_render_frame(frontend, larger_buffer, 640, 480);    assert(result == 0);    struct emu_frontend *impl = frontend;    assert(impl->width == 640);    assert(impl->height == 480);    // Limpar    free(test_buffer);    free(larger_buffer);    emu_frontend_shutdown(frontend);    printf("Testes de framebuffer concluídos com sucesso!\n");}static void test_frontend_events(void){    printf("Testando processamento de eventos...\n");    // Teste 1: Frontend válido    emu_frontend_t frontend = emu_frontend_init();    assert(frontend != NULL);    bool result = emu_frontend_process_events(frontend);    assert(result == true);    // Teste 2: Frontend inválido    result = emu_frontend_process_events(NULL);    assert(result == false);    // Teste 3: Frontend não inicializado    struct emu_frontend *impl = frontend;    impl->initialized = false;    result = emu_frontend_process_events(frontend);    assert(result == false);    // Limpar    emu_frontend_shutdown(frontend);    printf("Testes de eventos concluídos com sucesso!\n");}int main(void){    printf("Iniciando testes do frontend...\n\n");    test_frontend_init();    printf("\n");    test_frontend_framebuffer();    printf("\n");    test_frontend_events();    printf("\n");    printf("Todos os testes do frontend concluídos com sucesso!\n");    return 0;}