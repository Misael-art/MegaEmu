#include <stdio.h>#include <stdlib.h>#include <string.h>#include <assert.h>#include "../utils/enhanced_log.h"#define TEST_LOG_FILE "test.log"#define TEST_OUTPUT_FILE "test_output.log"// Função auxiliar para verificar se um arquivo contém uma stringstatic bool file_contains_string(const char *filename, const char *search_str){    FILE *file = fopen(filename, "r");    if (!file)        return false;    char line[1024];    bool found = false;    while (fgets(line, sizeof(line), file))    {        if (strstr(line, search_str) != NULL)        {            found = true;            break;        }    }    fclose(file);    return found;}#define EMU_LOG_FLAG_USE_ALL (EMU_LOG_FLAG_USE_TIMESTAMP | EMU_LOG_FLAG_USE_LEVEL | EMU_LOG_FLAG_USE_CATEGORY | EMU_LOG_FLAG_USE_FILE_LINE | EMU_LOG_FLAG_USE_COLOR)void test_log_init(void){    printf("Testando inicialização do sistema de logging...\n");    // Teste 1: Inicialização básica    emu_log_config_t config = {        .level = EMU_LOG_LEVEL_INFO,        .output = stderr,        .flags = EMU_LOG_FLAG_USE_ALL};    assert(emu_log_init(&config));    assert(emu_enhanced_log_is_enabled(EMU_LOG_LEVEL_INFO));    // Teste 2: Inicialização com arquivo    config.output = fopen("test.log", "w");    assert(emu_log_init(&config));    assert(emu_enhanced_log_is_enabled(EMU_LOG_LEVEL_INFO));    // Teste 3: Inicialização dupla    assert(emu_log_init(&config)); // Deve retornar false pois já está inicializado    printf("Testes de inicialização concluídos com sucesso!\n");}void test_log_levels(void){    printf("Testando níveis de log...\n");    // Teste 1: Mudança de nível    emu_log_set_level(EMU_LOG_LEVEL_DEBUG);    assert(emu_enhanced_log_is_enabled(EMU_LOG_LEVEL_DEBUG));    assert(!emu_enhanced_log_is_enabled(EMU_LOG_LEVEL_TRACE));    // Teste 2: Logs em diferentes níveis    EMU_LOG_ERROR(EMU_LOG_CAT_TEST, "Teste FATAL %s", "Mensagem");    EMU_LOG_ERROR(EMU_LOG_CAT_TEST, "Teste ERROR %s", "Mensagem");    EMU_LOG_WARN(EMU_LOG_CAT_TEST, "Teste WARN %s", "Mensagem");    EMU_LOG_INFO(EMU_LOG_CAT_TEST, "Teste INFO %s", "Mensagem");    EMU_LOG_DEBUG(EMU_LOG_CAT_TEST, "Teste DEBUG %s", "Mensagem");    EMU_LOG_TRACE(EMU_LOG_CAT_TEST, "Teste TRACE %s", "Mensagem");    printf("Testes de níveis de log concluídos com sucesso!\n");}void test_log_categories(void){    printf("Testando categorias de log...\n");    // Teste 1: Logs em diferentes categorias    EMU_LOG_INFO(EMU_LOG_CAT_CORE, "Teste CORE %s", "Mensagem");    EMU_LOG_INFO(EMU_LOG_CAT_CPU, "Teste CPU %s", "Mensagem");    EMU_LOG_INFO(EMU_LOG_CAT_MEMORY, "Teste MEMORY %s", "Mensagem");    EMU_LOG_INFO(EMU_LOG_CAT_VIDEO, "Teste VIDEO %s", "Mensagem");    EMU_LOG_INFO(EMU_LOG_CAT_AUDIO, "Teste AUDIO %s", "Mensagem");    EMU_LOG_INFO(EMU_LOG_CAT_IO, "Teste IO %s", "Mensagem");    EMU_LOG_INFO(EMU_LOG_CAT_FRONTEND, "Teste FRONTEND %s", "Mensagem");    EMU_LOG_INFO(EMU_LOG_CAT_PLATFORM, "Teste PLATFORM %s", "Mensagem");    EMU_LOG_INFO(EMU_LOG_CAT_TEST, "Teste TEST %s", "Mensagem");    printf("Testes de categorias de log concluídos com sucesso!\n");}void test_log_file_output(void){    printf("Testando saída para arquivo...\n");    const char *test_file = "test_output.log";    emu_log_config_t config = {        .level = EMU_LOG_LEVEL_INFO,        .output = fopen(test_file, "w"),        .flags = EMU_LOG_FLAG_USE_ALL};    assert(emu_log_init(&config));    // Teste 1: Log para arquivo    EMU_LOG_INFO(EMU_LOG_CAT_TEST, "Mensagem de teste para arquivo");    // Verificar se a mensagem foi escrita no arquivo    assert(file_contains_string(test_file, "Mensagem de teste para arquivo"));    // Limpar arquivo de teste    remove(test_file);    printf("Testes de saída para arquivo concluídos com sucesso!\n");}void test_log_shutdown(void){    printf("Testando finalização do sistema de logging...\n");    // Teste 1: Finalização normal    emu_log_shutdown();    assert(!emu_enhanced_log_is_enabled(EMU_LOG_LEVEL_INFO));    // Teste 2: Finalização dupla    emu_log_shutdown(); // Não deve causar problemas    printf("Testes de finalização concluídos com sucesso!\n");}int main(void){    printf("Iniciando testes do sistema de logging...\n\n");    test_log_init();    test_log_levels();    test_log_categories();    test_log_file_output();    test_log_shutdown();    printf("\nTodos os testes do sistema de logging concluídos com sucesso!\n");    return 0;}